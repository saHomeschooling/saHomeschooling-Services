<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Dashboard · SA Homeschooling</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="../../css/dashboard.css">
    <style>
        /* ─── Client-specific additions ─────────────────────────── */
        .hidden-file-input { display: none; }

        /* Edit mode field highlighting */
        .edit-mode .profile-value[contenteditable="true"] {
            background: white;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
            cursor: text;
        }

        .edit-mode .profile-field > label { color: var(--accent); }

        /* Editable field cursor */
        [contenteditable="true"] { cursor: text; }
        [contenteditable="false"] { cursor: default; }

        /* Section dividers */
        .section-label {
            font-family: var(--font-serif);
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--ink);
            margin: 1.75rem 0 1rem;
            padding-bottom: 0.625rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-label i { color: var(--accent); font-size: 0.9rem; }

        /* Photo upload area */
        .photo-upload-area { flex: 1; }
        .photo-upload-area .btn-edit { margin-bottom: 0.375rem; }

        /* Qualifications block */
        .qualification-item {
            background: var(--bg);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            border: 1px solid var(--border);
        }

        /* Contact block inner */
        .contact-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 0.625rem;
        }

        .contact-details { font-size: 0.9rem; color: var(--ink-2); line-height: 1.7; }

        /* Review items in client dashboard */
        .reviews-section .review-item .rating-stars { margin-bottom: 0.375rem; }

        .reviews-section .review-item .profile-value {
            font-style: italic;
            margin: 0;
        }

        /* Plan row */
        .plan-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 1.75rem 0 0.75rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .public-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--success);
        }

        /* Footer row */
        .card-footer {
            display: flex;
            gap: 1.5rem;
            justify-content: flex-end;
            align-items: center;
            flex-wrap: wrap;
        }

        .last-edited {
            color: var(--ink-4);
            font-size: 0.82rem;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
        }

        /* Edit mode badge state */
        #editModeBadge {
            cursor: pointer;
            transition: var(--transition);
        }

        #editModeBadge:hover { background: var(--success); color: white; }

        #editModeBadge.active {
            background: var(--accent);
            color: white;
        }

        /* Btn save */
        .btn-save {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            font-family: var(--font-sans);
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
        }

        .btn-save:hover { background: var(--accent-hover); }

        /* Welcome row */
        .welcome-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
        }

        /* Age group display - comma separated in view mode */
        .agegroup-display {
            background: var(--bg);
            padding: 0.625rem 0.875rem;
            border-radius: var(--radius);
            font-weight: 500;
            color: var(--ink);
            border: 1.5px solid var(--border-light);
            word-break: break-word;
            font-size: 0.9rem;
        }

        .agegroup-select-container { display: none; }
        .edit-mode .agegroup-display { display: none; }
        .edit-mode .agegroup-select-container { display: block; }
    </style>
</head>
<body>

    <!-- ─── Header (only Home link) ────────────────────────────── -->
    <header class="top-header">
        <div class="logo-area">
            <div class="trusted-text" style="border-left:none; padding-left:0;">
                Trusted Homeschooling Directory
                <span>SA Homeschooling</span>
            </div>
        </div>

        <!-- Desktop nav - only Home link -->
        <nav class="nav-links" aria-label="Main navigation">
            <a href="../homePage.html">Home</a>
        </nav>

        <!-- Mobile hamburger -->
        <button class="hamburger" id="hamburgerBtn" aria-label="Toggle navigation" aria-expanded="false">
            <span></span><span></span><span></span>
        </button>
    </header>

    <!-- Mobile nav - only Home link -->
    <nav class="mobile-nav" id="mobileNav" aria-label="Mobile navigation">
        <a href="../homePage.html">Home</a>
    </nav>

    <!-- ─── Main Content ───────────────────────────────────────── -->
    <main class="dash-wrapper">
        <!-- Page headline -->
        <div class="page-headline">
            <h1>My Provider Dashboard</h1>
            <div class="welcome-row">
                <p>Welcome back, <span id="welcomeName">Khan Academy SA</span></p>
                <a href="#" id="publicViewLink" class="profile-preview-badge" aria-label="Switch to public view">
                    <i class="fas fa-eye" aria-hidden="true"></i> public view
                </a>
            </div>
            <span class="status-notice" role="status">
                <i class="fas fa-clock" aria-hidden="true"></i>
                <strong>Status:</strong>
                <span class="pending-badge">Pending Approval</span>
                <span>Your profile is awaiting admin verification</span>
            </span>
        </div>

        <!-- ─── Main Dashboard Card ────────────────────────────── -->
        <div class="card client-dash" id="clientDashboard"
             data-user-email="contact@khanacademy.org.za"
             data-user-name="Khan Academy SA">

            <!-- Card header -->
            <div class="card-header">
                <i class="fas fa-user-circle" aria-hidden="true"></i>
                <h2>Profile Information</h2>
                <span class="badge" id="editModeBadge" onclick="toggleEditMode()" role="button" tabindex="0"
                      aria-label="Toggle edit mode">
                    <i class="far fa-edit" aria-hidden="true"></i> activate edit mode
                </span>
            </div>

            <!-- Photo upload row -->
            <div class="photo-placeholder">
                <div class="photo-round" onclick="document.getElementById('photoUpload').click();"
                     role="button" tabindex="0" aria-label="Upload profile photo"
                     onkeydown="if(event.key==='Enter')this.click()">
                    <i class="fas fa-camera" id="photoIcon" style="display:none;" aria-hidden="true"></i>
                    <img id="photoImg"
                         src="https://images.unsplash.com/photo-1560264280-88b68371db39?w=300&auto=format&fit=crop"
                         alt="Khan Academy SA profile photo"
                         style="display:block; width:100%; height:100%; object-fit:cover;">
                </div>
                <div class="photo-upload-area">
                    <button class="btn-edit" type="button"
                            onclick="document.getElementById('photoUpload').click();"
                            aria-label="Change photo or logo">
                        <i class="fas fa-pencil-alt" aria-hidden="true"></i> Change photo / logo
                    </button>
                    <p class="hint">Click to upload (JPG, PNG — max 5MB)</p>
                </div>
            </div>
            <input type="file" id="photoUpload" class="hidden-file-input" accept="image/*"
                   onchange="handlePhotoUpload(event)" aria-hidden="true">

            <!-- ── Account information ────────────────────────── -->
            <p class="section-label"><i class="fas fa-id-card" aria-hidden="true"></i> Account Information</p>

            <div class="two-col">
                <div class="profile-field">
                    <label for="fieldBusiness">Full name / Business <span aria-label="required">*</span></label>
                    <div class="profile-value" id="fieldBusiness" role="textbox" aria-multiline="false">Khan Academy SA</div>
                </div>
                <div class="profile-field">
                    <label for="fieldEmail">Email address <span aria-label="required">*</span></label>
                    <div class="profile-value" id="fieldEmail" role="textbox" aria-multiline="false">contact@khanacademy.org.za</div>
                </div>
                <div class="profile-field">
                    <label for="fieldAccountType">Account type <span aria-label="required">*</span></label>
                    <div class="profile-value" id="fieldAccountType" role="textbox" aria-multiline="false">Organization / Company</div>
                </div>
                <div class="profile-field">
                    <label for="fieldYears">Years of experience</label>
                    <select id="fieldYears" class="profile-value" disabled aria-label="Years of experience">
                        <option value="0-1">0–1 Years</option>
                        <option value="1-3">1–3 Years</option>
                        <option value="3-5">3–5 Years</option>
                        <option value="5-10">5–10 Years</option>
                        <option value="10+" selected>10+ Years</option>
                    </select>
                </div>
                <div class="profile-field">
                    <label>Languages spoken <span aria-label="required">*</span></label>
                    <!-- View mode -->
                    <div class="language-display" id="languagesDisplay">Afrikaans, English, isiXhosa, isiZulu</div>
                    <!-- Edit mode -->
                    <div class="language-select-container">
                        <select id="fieldLanguages" class="language-select" multiple size="5" disabled
                                aria-label="Select spoken languages (hold Ctrl/Cmd to select multiple)">
                            <option value="Afrikaans" selected>Afrikaans</option>
                            <option value="English" selected>English</option>
                            <option value="isiNdebele">isiNdebele</option>
                            <option value="isiXhosa" selected>isiXhosa</option>
                            <option value="isiZulu" selected>isiZulu</option>
                            <option value="Sesotho">Sesotho</option>
                            <option value="Sesotho sa Leboa">Sesotho sa Leboa</option>
                            <option value="Setswana">Setswana</option>
                            <option value="siSwati">siSwati</option>
                            <option value="Tshivenda">Tshivenda</option>
                            <option value="Xitsonga">Xitsonga</option>
                        </select>
                    </div>
                </div>
                <div class="profile-field">
                    <label for="fieldCategory">Primary category <span aria-label="required">*</span></label>
                    <div class="profile-value" id="fieldCategory" role="textbox" aria-multiline="false">Curriculum Provider</div>
                </div>
            </div>

            <!-- ── Tags ─────────────────────────────────────────── -->
            <div class="profile-field">
                <label>Tags <span style="text-transform:none; font-weight:400; color:var(--ink-4);">(e.g. mathematics, tutoring, therapy)</span></label>
                <div id="tagsContainer" class="tags-container" role="list" aria-label="Current tags"></div>
                <div class="tag-input-wrapper" id="tagInputWrapper">
                    <input type="text" id="newTagInput" placeholder="Add a tag…" disabled
                           onkeydown="if(event.key==='Enter'){event.preventDefault();addNewTag();}"
                           aria-label="New tag text">
                    <button id="addTagBtn" disabled onclick="addNewTag()" aria-label="Add tag">Add</button>
                </div>
            </div>

            <!-- ── Bio ──────────────────────────────────────────── -->
            <div class="profile-field">
                <label for="fieldBio">Short bio <span aria-label="required">*</span></label>
                <div class="profile-value" id="fieldBio" style="min-height: 80px;" role="textbox" aria-multiline="true">Free world-class education for anyone anywhere. Our curriculum covers mathematics, science, computing, humanities and more. We provide video lessons, practice exercises, and personalized learning dashboards for homeschoolers across South Africa. Completely free, forever.</div>
            </div>

            <!-- ── Qualifications ────────────────────────────────── -->
            <p class="section-label"><i class="fas fa-graduation-cap" aria-hidden="true"></i> Qualifications &amp; Experience</p>

            <div class="qualification-item">
                <div class="inline-group">
                    <div class="profile-field">
                        <label for="fieldCertifications">Certifications</label>
                        <div class="profile-value" id="fieldCertifications" contenteditable="false" role="textbox">Khan Academy Certified Content Provider, Google for Education Partner</div>
                    </div>
                    <div class="profile-field">
                        <label for="fieldDegrees">Degrees</label>
                        <div class="profile-value" id="fieldDegrees" contenteditable="false" role="textbox">BSc Computer Science (Stanford), MEd (Harvard)</div>
                    </div>
                </div>
                <div class="inline-group" style="margin-bottom:0;">
                    <div class="profile-field">
                        <label for="fieldMemberships">Professional memberships</label>
                        <div class="profile-value" id="fieldMemberships" contenteditable="false" role="textbox">SA Curriculum Association, Digital Learning Collective</div>
                    </div>
                    <div class="profile-field">
                        <label>Background clearance</label>
                        <div>
                            <span class="badge-clearance" id="clearanceBadge">
                                <i class="fas fa-circle-check" aria-hidden="true"></i> Verified (2025)
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ── Service Details ───────────────────────────────── -->
            <p class="section-label"><i class="fas fa-briefcase" aria-hidden="true"></i> Service Details</p>

            <div class="inline-group">
                <div class="profile-field">
                    <label for="fieldServiceTitle">Service title <span aria-label="required">*</span></label>
                    <div class="profile-value" id="fieldServiceTitle" role="textbox" aria-multiline="false">Math &amp; Science Curriculum (Gr R–12)</div>
                </div>
                <div class="profile-field">
                    <label for="fieldAgeGroup">Age group served</label>
                    <!-- View mode: comma separated list -->
                    <div class="agegroup-display" id="ageGroupDisplay">5–7 years, 8–10 years, 11–13 years, 14–18 years</div>
                    <!-- Edit mode: multi-select dropdown -->
                    <div class="agegroup-select-container">
                        <select id="fieldAgeGroup" class="profile-value" multiple size="4" disabled
                                aria-label="Select age groups served (hold Ctrl/Cmd to select multiple)">
                            <option value="5–7 years" selected>5–7 years</option>
                            <option value="8–10 years" selected>8–10 years</option>
                            <option value="11–13 years" selected>11–13 years</option>
                            <option value="14–18 years" selected>14–18 years</option>
                        </select>
                    </div>
                </div>
                <div class="profile-field">
                    <label for="fieldMode">Mode of delivery</label>
                    <select id="fieldMode" class="profile-value" disabled aria-label="Mode of delivery">
                        <option value="online" selected>Online</option>
                        <option value="inperson">In Person</option>
                        <option value="hybrid">Hybrid</option>
                    </select>
                </div>
            </div>

            <!-- ── Location ──────────────────────────────────────── -->
            <p class="section-label"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> Location &amp; Reach</p>

            <div class="inline-group">
                <div class="profile-field">
                    <label for="fieldProvince">Province</label>
                    <select id="fieldProvince" class="profile-value" disabled aria-label="Province">
                        <option value="EC">Eastern Cape</option>
                        <option value="FS">Free State</option>
                        <option value="GP" selected>Gauteng</option>
                        <option value="KZN">KwaZulu-Natal</option>
                        <option value="LP">Limpopo</option>
                        <option value="MP">Mpumalanga</option>
                        <option value="NC">Northern Cape</option>
                        <option value="NW">North West</option>
                        <option value="WC">Western Cape</option>
                    </select>
                </div>
                <div class="profile-field">
                    <label for="fieldCity">City / Town</label>
                    <div class="profile-value" id="fieldCity" contenteditable="false" role="textbox" aria-multiline="false">Johannesburg</div>
                </div>
            </div>

            <div class="profile-field">
                <label for="fieldServiceAreaType">Service area <span aria-label="required">*</span></label>
                <div class="inline-flex-row">
                    <select id="fieldServiceAreaType" class="profile-value" style="width:auto;" disabled
                            aria-label="Service area type">
                        <option value="local">Local (specify radius)</option>
                        <option value="national" selected>National</option>
                        <option value="online">Online only</option>
                    </select>
                    <span id="radiusContainer" style="display:none; align-items:center; gap:0.375rem;">
                        <input type="number" id="fieldRadius" class="radius-input" value="30" min="1" max="200"
                               disabled aria-label="Service radius in km"> <span style="font-size:0.875rem; color:var(--ink-3);">km</span>
                    </span>
                </div>
            </div>

            <!-- ── Pricing ───────────────────────────────────────── -->
            <p class="section-label"><i class="fas fa-tag" aria-hidden="true"></i> Pricing &amp; Availability</p>

            <div class="inline-group">
                <div class="profile-field">
                    <label for="fieldPricingModel">Pricing model <span aria-label="required">*</span></label>
                    <select id="fieldPricingModel" class="profile-value" disabled aria-label="Pricing model">
                        <option value="hourly">Hourly</option>
                        <option value="package">Per package</option>
                        <option value="term">Per term</option>
                        <option value="custom" selected>Custom quote</option>
                    </select>
                </div>
                <div class="profile-field">
                    <label for="fieldStartingPrice">Starting price (optional)</label>
                    <div class="profile-value" id="fieldStartingPrice" role="textbox" aria-multiline="false">Free</div>
                </div>
            </div>

            <div class="profile-field">
                <label>Availability — Days</label>
                <div id="fieldAvailabilityDays" class="days-multi" role="group" aria-label="Available days">
                    <label class="day-checkbox"><input type="checkbox" value="Mon" checked disabled aria-label="Monday"> Mon</label>
                    <label class="day-checkbox"><input type="checkbox" value="Tue" checked disabled aria-label="Tuesday"> Tue</label>
                    <label class="day-checkbox"><input type="checkbox" value="Wed" checked disabled aria-label="Wednesday"> Wed</label>
                    <label class="day-checkbox"><input type="checkbox" value="Thu" checked disabled aria-label="Thursday"> Thu</label>
                    <label class="day-checkbox"><input type="checkbox" value="Fri" checked disabled aria-label="Friday"> Fri</label>
                    <label class="day-checkbox"><input type="checkbox" value="Sat" checked disabled aria-label="Saturday"> Sat</label>
                    <label class="day-checkbox"><input type="checkbox" value="Sun" disabled aria-label="Sunday"> Sun</label>
                </div>
                <div class="profile-value" id="fieldAvailabilityNotes" style="margin-top:0.5rem;" role="textbox" aria-multiline="false">24/7 Online — self-paced learning available anytime</div>
            </div>

            <!-- ── Contact & Social ──────────────────────────────── -->
            <p class="section-label"><i class="fas fa-address-card" aria-hidden="true"></i> Contact &amp; Online Presence</p>

            <div class="contact-block">
                <div class="contact-inner">
                    <strong style="font-size:0.9rem;">Primary contact</strong>
                    <label class="toggle-switch">
                        <input type="checkbox" id="publicToggle" checked disabled aria-label="Display contact publicly">
                        <span class="toggle-slider" aria-hidden="true"></span>
                        <span>Display publicly <i class="fas fa-globe" aria-hidden="true"></i></span>
                    </label>
                </div>
                <div class="contact-details">
                    <span id="fieldContactName">Support Team</span> ·
                    <span id="fieldPhone">+27 11 555 1234</span> ·
                    <span id="fieldContactEmail">support@khanacademy.org.za</span>
                </div>
                <div id="socialPreview" class="social-links-preview">
                    <span id="fieldSocial"><i class="fab fa-facebook" aria-hidden="true"></i> <i class="fab fa-twitter" aria-hidden="true"></i> @khanacademySA &nbsp;|&nbsp; www.khanacademy.org.za &nbsp;|&nbsp; FB, Twitter, YouTube</span>
                </div>
            </div>

            <!-- ── Plan & visibility ─────────────────────────────── -->
            <div class="plan-row">
                <span class="plan-badge"><i class="fas fa-crown" style="color:#f59e0b;" aria-hidden="true"></i> Free Listing</span>
                <span class="public-indicator"><i class="fas fa-circle-check" aria-hidden="true"></i> listing is public</span>
            </div>

            <!-- ── Reviews & Testimonials ────────────────────────── -->
            <div class="reviews-section" aria-label="Reviews and testimonials">
                <div class="profile-field">
                    <p class="section-label" style="border:none; margin:0 0 0.75rem;"><i class="fas fa-star" aria-hidden="true"></i> Reviews &amp; Testimonials <span style="font-family:var(--font-sans); font-size:0.75rem; font-weight:500; color:var(--ink-4);">(Paid tiers)</span></p>
                </div>
                <div class="review-item">
                    <div class="rating-stars" aria-label="5 stars">★★★★★</div>
                    <div class="profile-value" id="fieldReview1" contenteditable="false" role="textbox">"Excellent resource for our homeschool curriculum. The video lessons are clear and the practice exercises really help reinforce concepts." — Sarah J.</div>
                </div>
                <div class="review-item">
                    <div class="rating-stars" aria-label="5 stars">★★★★★</div>
                    <div class="profile-value" id="fieldReview2" contenteditable="false" role="textbox">"My kids love the math challenges. It's made learning fun and independent." — Thabo M.</div>
                </div>
                <div class="review-item">
                    <div class="profile-value" id="fieldReview3" contenteditable="false" style="font-style:italic; color:var(--ink-3);" role="note">Average rating: 4.9/5 (based on 156 reviews)</div>
                </div>
            </div>

            <hr>

            <!-- Card footer -->
            <div class="card-footer">
                <span class="last-edited"><i class="far fa-clock" aria-hidden="true"></i> last edited today</span>
                <div id="editControls" aria-live="polite">
                    <button class="btn-save" id="saveBtn" onclick="saveChanges()">
                        <i class="fas fa-floppy-disk" aria-hidden="true"></i> Save changes
                    </button>
                    <button class="btn-edit" id="cancelBtn" onclick="cancelEdit()">Cancel</button>
                </div>
                <span id="editModeHint" style="color:var(--ink-4); font-size:0.82rem; display:inline-flex; align-items:center; gap:0.375rem;">
                    <i class="far fa-eye" aria-hidden="true"></i> view only
                </span>
            </div>
        </div>

        <!-- The signup-mini section has been removed as requested -->

    </main>

    <!-- Footer placeholder -->
    <div id="footer-placeholder"></div>

    <script>
        fetch('../shared/footer.html')
            .then(r => r.text())
            .then(d => document.getElementById('footer-placeholder').innerHTML = d)
            .catch(() => {});
    </script>

    <script src="../../js/dashboards.js"></script>
    <script>
        // ─── Hamburger menu ──────────────────────────────────── //
        (function () {
            const btn = document.getElementById('hamburgerBtn');
            const nav = document.getElementById('mobileNav');

            btn.addEventListener('click', function () {
                const open = nav.classList.toggle('open');
                btn.classList.toggle('open', open);
                btn.setAttribute('aria-expanded', String(open));
            });

            document.addEventListener('click', function (e) {
                if (!btn.contains(e.target) && !nav.contains(e.target)) {
                    nav.classList.remove('open');
                    btn.classList.remove('open');
                    btn.setAttribute('aria-expanded', 'false');
                }
            });
        })();

        // ─── Edit mode badge keyboard access ─────────────────── //
        document.getElementById('editModeBadge').addEventListener('keydown', function (e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                toggleEditMode();
            }
        });

        // ─── Override tags for Khan Academy ──────────────────── //
        document.addEventListener('DOMContentLoaded', function () {
            if (typeof tags !== 'undefined') {
                tags = ['mathematics', 'science', 'online learning', 'free curriculum', 'video lessons'];
                renderTags();
            }
            updateLanguagesDisplay();
            updateAgeGroupDisplay();

            // Set links
            const userEmail = document.getElementById('fieldEmail').innerText.trim();
            const userName = document.getElementById('fieldBusiness').innerText.trim();
            document.getElementById('welcomeName').textContent = userName;
            const profileUrl = '../profile.html?email=' + encodeURIComponent(userEmail);
            document.getElementById('publicViewLink').href = profileUrl;
            document.getElementById('previewLink').href = profileUrl;
        });

        // ─── Language helpers ─────────────────────────────────── //
        function updateLanguagesDisplay() {
            const sel = document.getElementById('fieldLanguages');
            const display = document.getElementById('languagesDisplay');
            if (!sel || !display) return;
            const selected = Array.from(sel.options).filter(o => o.selected).map(o => o.value);
            display.textContent = selected.join(', ');
        }

        // ─── Age group helpers ─────────────────────────────────── //
        function updateAgeGroupDisplay() {
            const sel = document.getElementById('fieldAgeGroup');
            const display = document.getElementById('ageGroupDisplay');
            if (!sel || !display) return;
            const selected = Array.from(sel.options).filter(o => o.selected).map(o => o.value);
            display.textContent = selected.join(', ');
        }

        // ─── Wrap toggleEditMode to handle language and age group display ───── //
        const _origToggle = window.toggleEditMode;
        window.toggleEditMode = function () {
            _origToggle();
            const langDisplay = document.getElementById('languagesDisplay');
            const langContainer = document.querySelector('.language-select-container');
            const ageDisplay = document.getElementById('ageGroupDisplay');
            const ageContainer = document.querySelector('.agegroup-select-container');
            const badge = document.getElementById('editModeBadge');
            
            if (editModeActive) {
                if (langDisplay) langDisplay.style.display = 'none';
                if (langContainer) langContainer.style.display = 'block';
                if (ageDisplay) ageDisplay.style.display = 'none';
                if (ageContainer) ageContainer.style.display = 'block';
                badge.classList.add('active');
                badge.innerHTML = '<i class="fas fa-pencil-alt" aria-hidden="true"></i> edit mode active';
            } else {
                if (langDisplay) langDisplay.style.display = 'block';
                if (langContainer) langContainer.style.display = 'none';
                if (ageDisplay) ageDisplay.style.display = 'block';
                if (ageContainer) ageContainer.style.display = 'none';
                updateLanguagesDisplay();
                updateAgeGroupDisplay();
                badge.classList.remove('active');
                badge.innerHTML = '<i class="far fa-edit" aria-hidden="true"></i> activate edit mode';
            }
        };

        const _origCancel = window.cancelEdit;
        window.cancelEdit = function () {
            _origCancel();
            const langDisplay = document.getElementById('languagesDisplay');
            const langContainer = document.querySelector('.language-select-container');
            const ageDisplay = document.getElementById('ageGroupDisplay');
            const ageContainer = document.querySelector('.agegroup-select-container');
            const badge = document.getElementById('editModeBadge');
            
            if (!editModeActive) {
                if (langDisplay) langDisplay.style.display = 'block';
                if (langContainer) langContainer.style.display = 'none';
                if (ageDisplay) ageDisplay.style.display = 'block';
                if (ageContainer) ageContainer.style.display = 'none';
                updateLanguagesDisplay();
                updateAgeGroupDisplay();
                badge.classList.remove('active');
                badge.innerHTML = '<i class="far fa-edit" aria-hidden="true"></i> activate edit mode';
            }
        };

        const _origSave = window.saveChanges;
        window.saveChanges = function () {
            _origSave();
            const langDisplay = document.getElementById('languagesDisplay');
            const langContainer = document.querySelector('.language-select-container');
            const ageDisplay = document.getElementById('ageGroupDisplay');
            const ageContainer = document.querySelector('.agegroup-select-container');
            const badge = document.getElementById('editModeBadge');
            
            if (!editModeActive) {
                if (langDisplay) langDisplay.style.display = 'block';
                if (langContainer) langContainer.style.display = 'none';
                if (ageDisplay) ageDisplay.style.display = 'block';
                if (ageContainer) ageContainer.style.display = 'none';
                updateLanguagesDisplay();
                updateAgeGroupDisplay();
                badge.classList.remove('active');
                badge.innerHTML = '<i class="far fa-edit" aria-hidden="true"></i> activate edit mode';
            }
        };
    </script>
</body>
</html>